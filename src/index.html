<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Elm SSE demo</title>
    <meta name="description" content="Demonstration of using SSE from Elm">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <!--suppress HtmlUnknownTarget -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/vendor/modernizr-2.8.3.min.js"></script>
</head>
<body>
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->

<div id="elm"></div>

<script src="js/plugins.js"></script>
<script src="js/main.js"></script>
<script src="js/vendor/elm.js"></script>
<script>
    var app = Elm.Main.embed(document.getElementById("elm"));

    var sources = {};
    app.ports.listenForTypedEvents.subscribe(function (addressAndEventType) {
        var address = addressAndEventType[0];
        var eventType = addressAndEventType[1];
        console.log("Subscribing for events on " + address + " of type " + eventType);
        sources[eventType] = new EventSource(address);
        sources[eventType].addEventListener(eventType, function (event) {
            app.ports.events.send({data: event.data || '', eventType: eventType, id: event.id || ''})
        })
    });

</script>
<script src="js/elm-ports.js"></script>

</body>
</html>
